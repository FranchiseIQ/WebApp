<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta name="description" content="FranResearch Sports - Live scores and betting odds for NFL, NBA, WNBA, NHL, MLS, and MLB franchise leagues.">
    <meta name="keywords" content="sports franchises, NFL scores, NBA scores, MLB scores, NHL scores, MLS scores, WNBA scores, betting odds">
    <title>Live Sports Dashboard - FranResearch</title>

    <!-- Global Styles -->
    <link rel="stylesheet" href="assets/css/global.css">

    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(255,255,255,0.06);
            --text: #f8fafc;
            --secondary: #cbd5e1;
            --accent1: #6366f1;
            --accent2: #a855f7;
            --live: #ef4444;
            --green: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            padding-top: 170px; /* Account for fixed ticker + nav */
            padding-bottom: 100px;
        }

        /* Global Stock Ticker - Fixed positioning */
        .global-ticker {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 300;
            background: #0a0a0a;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .global-ticker iframe {
            width: 100%;
            height: 120px;
            border: none;
            display: block;
            overflow: hidden;
        }

        /* Navigation Bar - Fixed below ticker */
        .main-nav {
            position: fixed;
            top: 120px;
            left: 0;
            width: 100%;
            z-index: 299;
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(15, 23, 42, 0.95);
            padding: 12px 24px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            backdrop-filter: blur(12px);
            overflow-x: auto;
            box-sizing: border-box;
        }

        .main-nav .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            font-weight: 700;
            font-size: 18px;
            color: var(--text);
            margin-right: auto;
        }

        .main-nav .nav-brand img {
            height: 28px;
            width: auto;
        }

        .main-nav a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            padding: 6px 10px;
            border-radius: 6px;
            transition: color 0.15s, background 0.15s;
        }

        .main-nav a:hover {
            color: var(--text);
            background: rgba(255, 255, 255, 0.08);
        }

        .main-nav a.active {
            color: var(--accent1);
            background: rgba(99, 102, 241, 0.15);
        }

        /* Franchisor Filter */
        .franchisor-filter {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 12px 20px;
            background: rgba(0,0,0,0.2);
            align-items: center;
            flex-wrap: wrap;
        }

        .franchisor-filter label {
            font-size: 0.9em;
            color: var(--secondary);
            font-weight: 500;
        }

        .team-filter-dropdown {
            position: relative;
            display: inline-block;
        }

        .team-filter-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            background: #1e293b;
            color: var(--text);
            cursor: pointer;
            min-width: 200px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .team-filter-btn:hover {
            background: #334155;
        }

        .team-filter-btn .arrow {
            transition: transform 0.2s;
        }

        .team-filter-btn.open .arrow {
            transform: rotate(180deg);
        }

        .team-filter-menu {
            position: absolute;
            top: 100%;
            left: 0;
            width: 280px;
            max-height: 350px;
            overflow-y: auto;
            background: #1e293b;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            z-index: 100;
            display: none;
            margin-top: 4px;
        }

        .team-filter-menu.open {
            display: block;
        }

        .team-filter-menu .menu-header {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-filter-menu .menu-header button {
            background: transparent;
            border: none;
            color: var(--accent1);
            cursor: pointer;
            font-size: 0.85em;
            padding: 4px 8px;
        }

        .team-filter-menu .menu-header button:hover {
            text-decoration: underline;
        }

        .team-filter-menu .team-group {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .team-filter-menu .team-group:last-child {
            border-bottom: none;
        }

        .team-filter-menu .group-label {
            padding: 6px 12px;
            font-size: 0.75em;
            text-transform: uppercase;
            color: var(--secondary);
            font-weight: 600;
        }

        .team-filter-menu .team-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .team-filter-menu .team-option:hover {
            background: rgba(255,255,255,0.05);
        }

        .team-filter-menu .team-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--accent1);
            cursor: pointer;
        }

        .team-filter-menu .team-option label {
            cursor: pointer;
            flex: 1;
            font-size: 0.9em;
        }

        .selected-teams-count {
            background: var(--accent1);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }

        /* Hero Header */
        .sports-hero {
            text-align: center;
            padding: 40px 20px 20px;
            background: linear-gradient(135deg, var(--accent1) 0%, var(--accent2) 100%);
            margin-bottom: 0;
        }

        .sports-hero h1 {
            font-size: 2.2em;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .sports-hero p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        /* League Tabs */
        .league-tabs {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
            background: rgba(0,0,0,0.3);
            justify-content: center;
            flex-wrap: wrap;
        }

        .league-tabs button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: #1e293b;
            color: var(--text);
            white-space: nowrap;
        }

        .league-tabs button:hover {
            background: #334155;
        }

        .league-tabs button.active {
            background: linear-gradient(135deg, var(--accent1) 0%, var(--accent2) 100%);
            color: white;
        }

        .league-tabs button.hidden {
            display: none;
        }

        /* Day Selector */
        .day-selector {
            display: flex;
            gap: 10px;
            padding: 16px 20px;
            overflow-x: auto;
            justify-content: center;
            background: rgba(0,0,0,0.2);
        }

        .day-selector button {
            padding: 10px 18px;
            border: 2px solid #334155;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
            color: var(--secondary);
            white-space: nowrap;
        }

        .day-selector button:hover {
            border-color: var(--accent1);
            color: var(--text);
        }

        .day-selector button.active {
            background: var(--accent1);
            border-color: var(--accent1);
            color: white;
        }

        /* Sports Container */
        #sports-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Game Card */
        .game-card {
            background: var(--card);
            padding: 22px;
            border-radius: 14px;
            margin: 22px 0;
            backdrop-filter: blur(14px);
            box-shadow: 0 4px 22px rgba(0,0,0,0.25);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .game-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .status-text {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--secondary);
        }

        .status-text.live {
            color: var(--live);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .league-tag {
            background: rgba(99, 102, 241, 0.3);
            color: var(--accent1);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .teams-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .team {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .team:last-child {
            flex-direction: row-reverse;
            text-align: right;
        }

        .team-logo {
            width: 42px;
            height: 42px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            object-fit: contain;
        }

        .team-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .team-name {
            font-size: 1.1em;
            font-weight: 700;
            color: var(--text);
        }

        .team-record {
            font-size: 0.85em;
            color: var(--secondary);
        }

        .team-score {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--text);
            min-width: 50px;
            text-align: center;
        }

        .team-score.winner {
            color: var(--green);
        }

        .odds-column {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 120px;
            text-align: center;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        .odds-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
        }

        .odds-row label {
            color: var(--secondary);
        }

        .odds-row span {
            color: var(--text);
            font-weight: 600;
        }

        /* Empty Message */
        .empty-msg {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .empty-msg h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: var(--text);
        }

        /* Loading */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--secondary);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent1);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        #site-footer {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0,0,0,0.3);
            margin-top: 40px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        #site-footer a {
            color: var(--accent1);
            text-decoration: none;
        }

        #site-footer a:hover {
            text-decoration: underline;
        }

        /* Fixed Bottom News Ticker */
        .news-ticker-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 999;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sports-hero h1 {
                font-size: 1.8em;
            }

            .teams-row {
                flex-direction: column;
                gap: 15px;
            }

            .team, .team:last-child {
                flex-direction: row;
                text-align: left;
                width: 100%;
                justify-content: space-between;
            }

            .odds-column {
                width: 100%;
            }

            .league-tabs {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Global Stock Ticker -->
    <div class="global-ticker">
        <iframe src="Website/ticker.html" title="Franchise stock ticker" loading="lazy"></iframe>
    </div>

    <!-- Navigation Bar -->
    <nav class="main-nav">
        <a href="index.html" class="nav-brand">
            <img src="logo.svg" alt="FranResearch">
            <span>FranResearch</span>
        </a>
        <a href="Website/ticker.html">Ticker</a>
        <a href="StockChart/chart.html">Charts</a>
        <a href="FranchiseMap/map.html">Map</a>
        <a href="FranchiseNews/news-feed.html">News</a>
        <a href="sports.html" class="active">Sports</a>
        <a href="franchise_calculators_module/index.html">Calculators</a>
        <a href="about.html">About</a>
    </nav>

    <!-- Hero Header -->
    <header class="sports-hero">
        <h1>Live Sports Dashboard</h1>
        <p>Real-time franchise league scores and betting odds</p>
    </header>

    <!-- League Tabs -->
    <nav class="league-tabs" id="league-tabs">
        <button data-league="NFL" class="active">NFL</button>
        <button data-league="NBA">NBA</button>
        <button data-league="WNBA">WNBA</button>
        <button data-league="NHL">NHL</button>
        <button data-league="MLS">MLS</button>
        <button data-league="MLB">MLB</button>
    </nav>

    <!-- Franchisor Filter -->
    <div class="franchisor-filter">
        <label>Filter by Team:</label>
        <div class="team-filter-dropdown" id="team-filter-dropdown">
            <button class="team-filter-btn" id="team-filter-btn">
                <span id="filter-btn-text">All Teams</span>
                <span class="arrow">&#9662;</span>
            </button>
            <div class="team-filter-menu" id="team-filter-menu">
                <div class="menu-header">
                    <span>Select Teams</span>
                    <div>
                        <button id="select-all-teams">Select All</button>
                        <button id="clear-all-teams">Clear</button>
                    </div>
                </div>
                <div id="team-checkboxes"></div>
            </div>
        </div>
    </div>

    <!-- Day Selector -->
    <div class="day-selector" id="day-selector"></div>

    <!-- Game List -->
    <section id="sports-container">
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Loading sports data...</p>
        </div>
    </section>

    <!-- Footer -->
    <footer id="site-footer">
        <p>&copy; 2024 FranResearch Sports. <a href="index.html">Back to Main Site</a></p>
        <p style="margin-top: 10px; font-size: 0.9em; color: var(--secondary);">
            Data provided by ESPN | Updates every 60 seconds
        </p>
    </footer>

    <!-- Fixed Bottom News Ticker -->
    <div id="franchise-news-ticker-bottom" class="news-ticker-bottom"></div>

    <!-- News Widget Scripts -->
    <script src="FranchiseNews/newsService.js"></script>
    <script src="FranchiseNews/news-widget.js"></script>

    <script>
        // League configuration with local data files
        const LEAGUES = {
            NFL: { dataUrl: 'data/football/current-week.json', icon: 'üèà', leagueFilter: 'NFL' },
            NBA: { dataUrl: 'data/basketball/current-games.json', icon: 'üèÄ', leagueFilter: 'NBA' },
            WNBA: { dataUrl: 'data/basketball/current-games.json', icon: 'üèÄ', leagueFilter: 'WNBA' },
            NHL: { dataUrl: 'data/hockey/current-games.json', icon: 'üèí', leagueFilter: 'NHL' },
            MLS: { dataUrl: 'data/soccer/current-games.json', icon: '‚öΩ', leagueFilter: 'MLS' },
            MLB: { dataUrl: 'data/baseball/current-games.json', icon: '‚öæ', leagueFilter: 'MLB' }
        };

        // Sample betting odds (in production, this would come from an odds API)
        const SAMPLE_ODDS = {
            spreads: [-3.5, -7, -2.5, 3, -1, 6.5, -4, 2, -6, 1.5],
            totals: [44.5, 47, 41.5, 52, 48.5, 45, 50.5, 43, 49, 46.5]
        };

        let currentLeague = 'NFL';
        let currentDate = new Date();
        let gamesCache = {};
        let allGames = [];
        let selectedTeams = new Set(); // Empty = show all teams

        // Format time to 12-hour EST
        function formatTimeEST(isoString) {
            if (!isoString) return 'TBD';

            try {
                const date = new Date(isoString);
                if (isNaN(date.getTime())) return 'TBD';

                const options = {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true,
                    timeZone: 'America/New_York'
                };

                return date.toLocaleTimeString('en-US', options) + ' EST';
            } catch (e) {
                return 'TBD';
            }
        }

        // Format date for display
        function formatDateShort(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${days[date.getDay()]}, ${months[date.getMonth()]} ${date.getDate()}`;
        }

        // Get date string for comparison
        function getDateString(date) {
            return date.toISOString().split('T')[0];
        }

        // Check if game is on selected date
        function isGameOnDate(game, date) {
            if (!game.startTime) return false;
            const gameDate = new Date(game.startTime);
            return getDateString(gameDate) === getDateString(date);
        }

        // Generate 7-day date buttons
        function generateDaySelector() {
            const container = document.getElementById('day-selector');
            container.innerHTML = '';

            const today = new Date();

            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);

                const btn = document.createElement('button');
                btn.textContent = i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : formatDateShort(date);
                btn.dataset.date = getDateString(date);

                if (i === 0) btn.classList.add('active');

                btn.addEventListener('click', () => {
                    document.querySelectorAll('.day-selector button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDate = date;
                    renderGames();
                });

                container.appendChild(btn);
            }
        }

        // Fetch games from local JSON files
        async function fetchGames(league) {
            const config = LEAGUES[league];
            if (!config) return [];

            const cacheKey = `${league}-data`;
            if (gamesCache[cacheKey]) {
                return gamesCache[cacheKey];
            }

            try {
                const response = await fetch(config.dataUrl);
                if (!response.ok) {
                    console.warn(`No data file for ${league}`);
                    return [];
                }

                const data = await response.json();
                let games = data?.games || [];

                // Filter by league if needed (e.g., NCAA vs NFL in football data)
                if (config.leagueFilter) {
                    games = games.filter(g => g.league === config.leagueFilter);
                }

                gamesCache[cacheKey] = games;
                return games;
            } catch (error) {
                console.error(`Error fetching ${league} games:`, error);
                return [];
            }
        }

        // Get random odds for a game (simulated - in production use real odds API)
        function getGameOdds(gameId) {
            const hash = gameId.split('').reduce((a, b) => ((a << 5) - a + b.charCodeAt(0)) | 0, 0);
            const spreadIdx = Math.abs(hash) % SAMPLE_ODDS.spreads.length;
            const totalIdx = Math.abs(hash >> 4) % SAMPLE_ODDS.totals.length;
            return {
                spread: SAMPLE_ODDS.spreads[spreadIdx],
                total: SAMPLE_ODDS.totals[totalIdx]
            };
        }

        // Normalize game status
        function normalizeStatus(game) {
            const status = (game.status || '').toLowerCase();
            if (status === 'final' || status === 'post') return 'FINAL';
            if (status === 'in_progress' || status === 'live' || status === 'in') return 'LIVE';
            if (status === 'postponed') return 'POSTPONED';
            if (status === 'cancelled' || status === 'canceled') return 'CANCELLED';
            return 'UPCOMING';
        }

        // Build game card HTML
        function buildGameCard(game, leagueKey) {
            const config = LEAGUES[leagueKey];
            const status = normalizeStatus(game);
            const homeScore = game.homeScore ?? 0;
            const awayScore = game.awayScore ?? 0;
            const isLive = status === 'LIVE';
            const isFinal = status === 'FINAL';
            const isUpcoming = status === 'UPCOMING';

            const homeWinner = isFinal && homeScore > awayScore;
            const awayWinner = isFinal && awayScore > homeScore;

            // Get game info
            const homeTeam = game.homeTeam || {};
            const awayTeam = game.awayTeam || {};
            const venue = game.venue || homeTeam.venue || '';

            // Get odds for upcoming games
            const odds = isUpcoming ? getGameOdds(game.id || '') : null;

            let statusText = '';
            if (isLive) {
                const quarter = game.quarter || game.period || '';
                const clock = game.clock || '';
                statusText = `LIVE${quarter ? ` - Q${quarter}` : ''}${clock && clock !== '0:00' ? ` ${clock}` : ''}`;
            } else if (isFinal) {
                statusText = 'FINAL';
            } else if (status === 'POSTPONED') {
                statusText = 'POSTPONED';
            } else if (status === 'CANCELLED') {
                statusText = 'CANCELLED';
            } else {
                statusText = formatTimeEST(game.startTime);
            }

            const defaultLogo = 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23334155%22 width=%22100%22 height=%22100%22/></svg>';

            return `
                <div class="game-card">
                    <div class="game-status-bar">
                        <span class="status-text ${isLive ? 'live' : ''}">${statusText}</span>
                        <span class="league-tag">${config.icon} ${leagueKey}</span>
                    </div>

                    <div class="teams-row">
                        <div class="team">
                            <img src="${awayTeam.logoUrl || defaultLogo}"
                                 alt="${awayTeam.name || 'Away'}"
                                 class="team-logo"
                                 onerror="this.src='${defaultLogo}'">
                            <div class="team-info">
                                <div class="team-name">${awayTeam.name || 'Away Team'}</div>
                                ${awayTeam.record ? `<div class="team-record">${awayTeam.record}</div>` : ''}
                            </div>
                            ${(isLive || isFinal) ? `<div class="team-score ${awayWinner ? 'winner' : ''}">${awayScore}</div>` : ''}
                        </div>

                        <div class="odds-column">
                            ${isUpcoming && odds ? `
                                <div class="odds-row">
                                    <label>Spread:</label>
                                    <span>${odds.spread > 0 ? '+' : ''}${odds.spread}</span>
                                </div>
                                <div class="odds-row">
                                    <label>O/U:</label>
                                    <span>${odds.total}</span>
                                </div>
                            ` : `
                                <div class="odds-row">
                                    <label>Spread:</label>
                                    <span>‚Äì</span>
                                </div>
                                <div class="odds-row">
                                    <label>O/U:</label>
                                    <span>‚Äì</span>
                                </div>
                            `}
                            <div class="odds-row">
                                <label>Venue:</label>
                                <span style="font-size: 0.8em;">${venue ? venue.substring(0, 18) : '‚Äì'}</span>
                            </div>
                        </div>

                        <div class="team">
                            <img src="${homeTeam.logoUrl || defaultLogo}"
                                 alt="${homeTeam.name || 'Home'}"
                                 class="team-logo"
                                 onerror="this.src='${defaultLogo}'">
                            <div class="team-info">
                                <div class="team-name">${homeTeam.name || 'Home Team'}</div>
                                ${homeTeam.record ? `<div class="team-record">${homeTeam.record}</div>` : ''}
                            </div>
                            ${(isLive || isFinal) ? `<div class="team-score ${homeWinner ? 'winner' : ''}">${homeScore}</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        // Build team filter checkboxes based on current games
        function buildTeamFilter(games) {
            const teamsMap = new Map();

            games.forEach(game => {
                if (game.homeTeam) {
                    teamsMap.set(game.homeTeam.shortName || game.homeTeam.name, game.homeTeam.name);
                }
                if (game.awayTeam) {
                    teamsMap.set(game.awayTeam.shortName || game.awayTeam.name, game.awayTeam.name);
                }
            });

            const sortedTeams = Array.from(teamsMap.entries()).sort((a, b) => a[1].localeCompare(b[1]));

            const container = document.getElementById('team-checkboxes');
            if (!container) return;

            if (sortedTeams.length === 0) {
                container.innerHTML = '<div style="padding: 12px; color: var(--secondary);">No teams available</div>';
                return;
            }

            container.innerHTML = `
                <div class="team-group">
                    <div class="group-label">${currentLeague} Teams</div>
                    ${sortedTeams.map(([shortName, fullName]) => `
                        <div class="team-option">
                            <input type="checkbox" id="team-${shortName}" value="${shortName}"
                                   ${selectedTeams.size === 0 || selectedTeams.has(shortName) ? 'checked' : ''}>
                            <label for="team-${shortName}">${fullName}</label>
                        </div>
                    `).join('')}
                </div>
            `;

            // Add event listeners to checkboxes
            container.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    updateSelectedTeams();
                    renderGames();
                });
            });
        }

        // Update selected teams from checkboxes
        function updateSelectedTeams() {
            const checkboxes = document.querySelectorAll('#team-checkboxes input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const noneChecked = Array.from(checkboxes).every(cb => !cb.checked);

            if (allChecked || noneChecked) {
                selectedTeams.clear(); // Show all
            } else {
                selectedTeams.clear();
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        selectedTeams.add(cb.value);
                    }
                });
            }

            updateFilterButtonText();
        }

        // Update filter button text
        function updateFilterButtonText() {
            const btn = document.getElementById('filter-btn-text');
            if (!btn) return;

            if (selectedTeams.size === 0) {
                btn.textContent = 'All Teams';
            } else if (selectedTeams.size === 1) {
                btn.textContent = Array.from(selectedTeams)[0];
            } else {
                btn.innerHTML = `${selectedTeams.size} Teams <span class="selected-teams-count">${selectedTeams.size}</span>`;
            }
        }

        // Setup team filter dropdown
        function setupTeamFilter() {
            const btn = document.getElementById('team-filter-btn');
            const menu = document.getElementById('team-filter-menu');
            const selectAll = document.getElementById('select-all-teams');
            const clearAll = document.getElementById('clear-all-teams');

            if (!btn || !menu) return;

            // Toggle dropdown
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                btn.classList.toggle('open');
                menu.classList.toggle('open');
            });

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.team-filter-dropdown')) {
                    btn.classList.remove('open');
                    menu.classList.remove('open');
                }
            });

            // Select all
            if (selectAll) {
                selectAll.addEventListener('click', () => {
                    document.querySelectorAll('#team-checkboxes input[type="checkbox"]').forEach(cb => {
                        cb.checked = true;
                    });
                    selectedTeams.clear();
                    updateFilterButtonText();
                    renderGames();
                });
            }

            // Clear all
            if (clearAll) {
                clearAll.addEventListener('click', () => {
                    document.querySelectorAll('#team-checkboxes input[type="checkbox"]').forEach(cb => {
                        cb.checked = false;
                    });
                    selectedTeams.clear();
                    updateFilterButtonText();
                    renderGames();
                });
            }
        }

        // Render games for current league and date
        async function renderGames() {
            const container = document.getElementById('sports-container');
            const config = LEAGUES[currentLeague];

            container.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading ${currentLeague} games...</p>
                </div>
            `;

            try {
                const games = await fetchGames(currentLeague);
                allGames = games;

                // Build team filter with all available teams
                buildTeamFilter(games);

                // Filter by date - show all games for "Today" if it includes games from current week
                let filteredGames = games.filter(game => {
                    const gameDate = new Date(game.startTime);
                    const selectedDate = new Date(currentDate);

                    // Check if game is on selected date (comparing just the date portion)
                    return gameDate.toDateString() === selectedDate.toDateString();
                });

                // If no games on exact date, show recent/upcoming games
                if (filteredGames.length === 0 && getDateString(currentDate) === getDateString(new Date())) {
                    // For "Today", show any in-progress or recent games
                    filteredGames = games.filter(game => {
                        const status = normalizeStatus(game);
                        return status === 'LIVE' || status === 'FINAL';
                    }).slice(0, 10);

                    // If still no games, show upcoming
                    if (filteredGames.length === 0) {
                        filteredGames = games.filter(game => normalizeStatus(game) === 'UPCOMING').slice(0, 5);
                    }
                }

                // Filter by selected teams if any are selected
                if (selectedTeams.size > 0) {
                    filteredGames = filteredGames.filter(game => {
                        const homeShort = game.homeTeam?.shortName || game.homeTeam?.name || '';
                        const awayShort = game.awayTeam?.shortName || game.awayTeam?.name || '';
                        return selectedTeams.has(homeShort) || selectedTeams.has(awayShort);
                    });
                }

                if (filteredGames.length === 0) {
                    container.innerHTML = `
                        <div class="empty-msg">
                            <h3>No ${currentLeague} games scheduled</h3>
                            <p>Check back on active game days for real-time franchise scores.</p>
                        </div>
                    `;
                    return;
                }

                // Sort by time
                filteredGames.sort((a, b) => {
                    const timeA = new Date(a.startTime || 0).getTime();
                    const timeB = new Date(b.startTime || 0).getTime();
                    return timeA - timeB;
                });

                container.innerHTML = filteredGames.map(game => buildGameCard(game, currentLeague)).join('');

            } catch (error) {
                console.error('Error rendering games:', error);
                container.innerHTML = `
                    <div class="empty-msg">
                        <h3>Unable to load games</h3>
                        <p>Please try again later.</p>
                    </div>
                `;
            }
        }

        // Set up league tab click handlers
        function setupLeagueTabs() {
            document.querySelectorAll('.league-tabs button').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.league-tabs button').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLeague = btn.dataset.league;
                    selectedTeams.clear(); // Reset team filter when changing leagues
                    updateFilterButtonText();
                    gamesCache = {}; // Clear cache to reload data for new league
                    renderGames();
                });
            });
        }

        // Initialize news ticker
        async function initNewsTicker() {
            try {
                if (window.FranchiseNewsWidget) {
                    await window.FranchiseNewsWidget.initTicker({
                        mountSelector: '#franchise-news-ticker-bottom',
                        categories: [
                            window.NEWS_CATEGORIES.TRADE_PRESS,
                            window.NEWS_CATEGORIES.BIG_PORTALS
                        ],
                        tickerSpeed: 90,
                        pauseOnHover: true,
                        showLabel: true,
                        labelText: 'Franchise News',
                        labelIcon: ''
                    });
                }
            } catch (error) {
                console.error('Failed to initialize news ticker:', error);
            }
        }

        // Initialize app
        async function init() {
            generateDaySelector();
            setupLeagueTabs();
            setupTeamFilter();

            // Load initial games
            await renderGames();

            // Initialize news ticker
            initNewsTicker();

            // Refresh every 60 seconds
            setInterval(() => {
                gamesCache = {}; // Clear cache
                renderGames();
            }, 60000);
        }

        // Start
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
